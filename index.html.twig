{% extends 'baseback.html.twig' %}

{% block title %}Medicament {% endblock %}

{% block body %}
<h1>Medicament </h1>
  <div id="table-actions" class="d-flex align-items-center justify-content-between mb-4">
        <div class="d-flex">
            <button id="btPrint" onclick="createPDF()" class="export-pdf-btn">
                <i class="fas fa-file-pdf"></i> Export PDF
            </button>
      
        </div>
    
    </div>
<form action="{{ path('app_medicament_search') }}" method="get" class="form-inline my-2 my-lg-0">
    <input class="form-control mr-sm-2" type="search" placeholder="Recherche" aria-label="Search" name="term">
    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Recherche</button>
</form>

<table class="table" id="table">
    <thead>
        <tr>
            <th>IdMedicament</th>
            <th onclick="sortTable(1)">Nom ⬆️</th>
            <th>Description</th>
            <th>Prix</th>
            <th>Type</th>
            <th>actions</th>
        </tr>
    </thead>
    <tbody>
    {% for medicament in medicaments %}
        <tr>
            <td>{{ medicament.idMedicament }}</td>
            <td>{{ medicament.nom }}</td>
            <td>{{ medicament.description }}</td>
            <td>{{ medicament.prix }}</td>
            <td>{{ medicament.type }}</td>
            <td>
                <a href="{{ path('app_medicament_show', {'idMedicament': medicament.idMedicament}) }}">show</a>
                <a href="{{ path('app_medicament_edit', {'idMedicament': medicament.idMedicament}) }}">edit</a>
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="6">Aucun médicament trouvé</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<a href="{{ path('app_medicament_new') }}">Créer nouveau</a>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
      function createPDF() {
        var clonedTable = document.getElementById('table').cloneNode(true);
        var rows = clonedTable.getElementsByTagName('tr');

        // Remove the last cell in each row
        Array.from(rows).forEach(function(row) {
            row.deleteCell(-1); // Deletes the last cell
        });

        var sTable = clonedTable.outerHTML;
        var style = "<style>";
        style += "table {width: 100%; border-collapse: collapse; margin-top: 20px;}";
        style += "th, td {border: 1px solid #ddd; padding: 8px; text-align: left;}";
        style += "th {background-color: #f2f2f2;}";
        style += "</style>";

        var win = window.open('', '', 'height=700,width=700');
        win.document.write('<html><head>');
        win.document.write('<title>Medicament List PDF</title>'); // <title> FOR PDF HEADER.
        win.document.write(style); // ADD STYLE INSIDE THE HEAD TAG.
        win.document.write('</head>');
        win.document.write('<body>');
        win.document.write(sTable); // THE TABLE CONTENTS INSIDE THE BODY TAG.
        win.document.write('</body></html>');
        win.document.close(); // CLOSE THE CURRENT WINDOW.
        win.print(); // PRINT THE CONTENTS.
    }
    </script>
    <script>
        function myFunction() {
          // Declare variables
          var input, filter, table, tr, td, i, txtValue;
          input = document.getElementById("myInput");
          filter = input.value.toUpperCase();
          table = document.getElementById("table");
          tr = table.getElementsByTagName("tr");
        
          // Loop through all table rows, and hide those who don't match the search query
          for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[1];
            if (td) {
              txtValue = td.textContent || td.innerText;
              if (txtValue.toUpperCase().indexOf(filter) > -1) {
                tr[i].style.display = "";
              } else {
                tr[i].style.display = "none";
              }
            }
          }
        }

        function sortTable(n) {
          var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
          table = document.getElementById("table");
          switching = true;
          dir = "asc";

          while (switching) {
            switching = false;
            rows = table.rows;

            for (i = 1; i < (rows.length - 1); i++) {
              shouldSwitch = false;
              x = rows[i].getElementsByTagName("TD")[n];
              y = rows[i + 1].getElementsByTagName("TD")[n];

              if (dir == "asc") {
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
                  break;
                }
              } else if (dir == "desc") {
                if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
                  break;
                }
              }
            }

            if (shouldSwitch) {
              rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
              switching = true;
              switchcount++;
            } else {
              if (switchcount == 0 && dir == "asc") {
                dir = "desc";
                switching = true;
              }
            }
          }
        }
    </script>
{% endblock %}
